import{a as H}from "./chunk-6ZDRUQ65.js";import{a as q}from "./chunk-LXZVEW4E.js";import{a as K,b as V,c as J,d as Q,e as W,f as X,g as Y,h as tt,i as et}from "./chunk-ULCJ533E.js";import{a as U}from "./chunk-RB3EWRZX.js";import{$ as P,A as a,D as E,E as I,J as S,L as u,N as v,O as $,P as F,Q as L,R as i,S as m,T as _,U as h,V as d,W as c,_ as s,a as D,aa as M,b as R,g as A,ha as g,ia as z,la as G,m as N,na as O,p as l,r as C,ra as Z,s as f,v as j,w as x,y as w}from "./chunk-54NRRIHP.js";var b=class o{http=l(O);URL=`${U.apiUrl}/comments`;PUBLIC_URL=`${U.apiUrl}/comments/public`;addComment(n){return this.http.post(`${this.URL}`,n).pipe(A(t=>R(D({},t),{blogPostId:n.blogPostId})))}updateComment(n){return this.http.put(`${this.URL}/${n.id}`,n).pipe()}findAllCommentsByBlogId(n){if(n)return this.http.get(`${this.PUBLIC_URL}/blogposts/${n}`)}delete(n){return this.http.delete(`${this.URL}/${n}`)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=N({token:o,factory:o.\u0275fac,providedIn:"root"})};function mt(o, n){if(o&1){let t=h();i(0,"button",8),d("click",function(){C(t);let r=c(3);return f(r.onUpdate())}),s(1," Aktualizuj "),m()}}function rt(o, n){if(o&1){let t=h();i(0,"button",8),d("click",function(){C(t);let r=c(3);return f(r.onUpdateCommit())}),s(1," Zapisz zmiany "),m()}}function at(o, n){if(o&1){let t=h();S(0,mt,2,0,"button",6)(1,rt,2,0,"button",6),i(2,"button",7),d("click",function(){C(t);let r=c(2);return f(r.onDelete())}),s(3," Usu\u0144 "),m()}if(o&2){let t=c(2);v(t.readonly()?0:1)}}function st(o, n){if(o&1&&(i(0,"div",4),S(1,at,4,1),m()),o&2){let t=c();a(),v(t.authenticated()?1:-1)}}function lt(o, n){if(o&1&&(i(0,"button",5),s(1,"Publikuj"),m()),o&2){let t=c();u("disabled",t.form.invalid||!t.authenticated)("ngClass",t.form.invalid||!t.authenticated?"bg-accent/50":"bg-accent")}}var y=class o{#t=l(b);#e=l(q);loggedUser=g(()=>this.#e.user()?.username);authenticated=g(()=>this.#e.authenticated());commentStateChange=j();fb=l(tt);form=this.fb.nonNullable.group({content:["",[V.required,V.maxLength(50)]]});createMode=x();author=E();readonly=E();content=x();blogPostId=x();commentId=x();commentEffect=z(()=>{this.readonly()&&this.content()&&this.form.controls.content.setValue(this.content())});saveComment(n){n.preventDefault(),this.#t.addComment({content:this.form.controls.content.value,blogPostId:this.blogPostId()}).subscribe(t=>{this.form.reset(),this.commentStateChange.emit(this.commentId())})}onUpdate(){this.#n()}onUpdateCommit(){this.#n(),this.#t.updateComment({id:this.commentId(),content:this.form.controls.content.value,blogPostId:this.blogPostId()}).subscribe(()=>{this.commentStateChange.emit(this.commentId())})}#n(){this.readonly.update(n=>!n)}onDelete(){this.#t.delete(this.commentId()).subscribe(()=>{this.commentStateChange.emit(this.commentId())})}ngOnInit(){this.form.controls.content.setValue(this.content())}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=I({type:o,selectors:[["app-post-comment"]],inputs:{createMode:[1,"createMode"],author:[1,"author"],readonly:[1,"readonly"],content:[1,"content"],blogPostId:[1,"blogPostId"],commentId:[1,"commentId"]},outputs:{commentStateChange:"commentStateChange",author:"authorChange",readonly:"readonlyChange"},decls:6,vars:7,consts:[[3,"ngSubmit","formGroup"],[1,"md:max-w-1/2","min-h-30","max-w-full","flex","flex-col","bg-secondary/40","rounded","mb-8","border-2","border-tertiary","p-4"],[1,"focus:outline-none","resize-none","w-full","min-h-16",3,"ngClass","formControl","readonly","placeholder"],[1,"flex","justify-end"],[1,"flex","gap-4"],["type","submit",1,"rounded","px-4","py-2",3,"disabled","ngClass"],["type","button",1,"bg-accent","px-4","py-2","rounded"],["type","button",1,"bg-error/80","px-4","py-2","rounded",3,"click"],["type","button",1,"bg-accent","px-4","py-2","rounded",3,"click"]],template:function(t, e){t&1&&(i(0,"form",0),d("ngSubmit",function(p){return e.saveComment(p)}),i(1,"div",1),_(2,"textarea",2),i(3,"div",3),S(4,st,2,1,"div",4)(5,lt,2,2,"button",5),m()()()),t&2&&(u("formGroup",e.form),a(2),u("ngClass",e.readonly()||!e.authenticated()?"cursor-default":"cursor-select")("formControl",e.form.controls.content)("readonly",e.readonly()||!e.authenticated())("placeholder",e.readonly()?"":e.authenticated()?"Miejsce na komentarz":"Zaloguj si\u0119 aby zamie\u015Bci\u0107 komentarz"),a(2),v(e.loggedUser()===e.author()?4:-1),a(),v(e.createMode()&&e.authenticated()?5:-1))},dependencies:[et,W,K,J,Q,X,Y,G],encapsulation:2})};function ct(o, n){if(o&1){let t=h();i(0,"div")(1,"span"),s(2),m(),i(3,"app-post-comment",8),d("commentStateChange",function(r){C(t);let p=c();return f(p.onCommentStateChange(r))}),m()()}if(o&2){let t,e=n.$implicit,r=c();a(2),M("Autor: ",e.author.username,""),a(),u("blogPostId",(t=r.post())==null?null:t.id)("commentId",e.id)("createMode",!1)("readonly",!0)("content",e.content)("author",e.author.username)}}var ot=class o{postService=l(H);commentService=l(b);route=l(Z);#t=w(void 0);post=g(()=>this.#t());#e=w([]);comments=g(()=>this.#e());onCommentStateChange(n){let t=this.post()?.id;t&&this.commentService.findAllCommentsByBlogId(t)?.subscribe(e=>{this.#e.set(e)})}ngOnInit(){this.route.paramMap.subscribe(n=>{let t=n.get("id");t&&this.postService.findById(Number(t)).subscribe(e=>{this.#t.set(e),this.#e.set(e.comments)})})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=I({type:o,selectors:[["app-post-page"]],hostAttrs:[1,"grow-1","bg-primary"],decls:19,vars:6,consts:[[1,"mt-4","flex","flex-col","mx-auto","w-4/5","gap-12"],[1,"flex","flex-col","gap-2"],[1,"md:text-7xl","text-5xl"],[1,"md:text-2xl","text-xl"],[1,"md:text-4xl","text-2xl"],[1,"text-2xl"],[1,"flex","flex-col","gap-6"],[3,"commentStateChange","createMode","blogPostId"],[3,"commentStateChange","blogPostId","commentId","createMode","readonly","content","author"]],template:function(t, e){if(t&1&&(i(0,"div",0)(1,"div",1)(2,"span",2),s(3),m(),i(4,"span",3),s(5),m()(),_(6,"hr"),i(7,"span",4),s(8),m(),_(9,"hr"),i(10,"span",5),s(11),m(),_(12,"hr"),i(13,"span",4),s(14,"Komentarze"),m(),i(15,"div",6)(16,"app-post-comment",7),d("commentStateChange",function(p){return e.onCommentStateChange(p)}),m(),F(17,ct,4,7,"div",null,$),m()()),t&2){let r,p,T,k,B;a(3),P((r=e.post())==null?null:r.title),a(2),M("Autor: ",(p=e.post())==null||p.author==null?null:p.author.username,""),a(3),P((T=e.post())==null?null:T.subtitle),a(3),P((k=e.post())==null?null:k.content),a(5),u("createMode",!0)("blogPostId",(B=e.post())==null?null:B.id),a(),L(e.comments())}},dependencies:[y],encapsulation:2})};export{ot as PostPageComponent};
